<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Theme Loader Debug Test</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { padding: 20px; }
.debug-section {
    background: #f8f9fa;
    padding: 15px;
    margin: 10px 0;
    border-radius: 5px;
    border-left: 4px solid #007bff;
}
.success { color: #28a745; }
.error { color: #dc3545; }
pre {
    background: white;
    padding: 10px;
    border-radius: 4px;
    max-height: 300px;
    overflow: auto;
}
</style>
</head>
<body>
<div class="container">
    <h1>Theme Loader Debug Test</h1>

    <!-- 1. APP_CONFIG -->
    <div class="debug-section">
        <h3>1. APP_CONFIG Check</h3>
        <div id="config-check">Checking...</div>
    </div>

    <!-- 2. JS File -->
    <div class="debug-section">
        <h3>2. JavaScript File Loading</h3>
        <div id="js-check">Checking...</div>
    </div>

    <!-- 3. API Test -->
    <div class="debug-section">
        <h3>3. API Test</h3>
        <button class="btn btn-primary" onclick="testAPI()">Test /api/themes</button>
        <div id="api-result" class="mt-3"></div>
    </div>

    <!-- 4. Console Logs -->
    <div class="debug-section">
        <h3>4. Console Logs</h3>
        <pre id="console-output"></pre>
    </div>
</div>

<!-- APP_CONFIG -->
<script>
window.APP_CONFIG = {
    API_BASE: '/api',
    TENANT_ID: 1,
    CSRF_TOKEN: 'test-token',
    USER_LANGUAGE: 'en',
    USER_DIRECTION: 'ltr',
    USER_ID: 1,
    PERMISSIONS: { canCreate: true, canEdit: true, canDelete: true, canExport: true, canActivate: true, isSuperAdmin: true },
    TRANSLATIONS: { processing: 'Processing...', saving: 'Saving...', deleting: 'Deleting...', loading: 'Loading...' },
    ENDPOINTS: { themes: '/api/themes', design_settings: '/api/design_settings', color_settings: '/api/color_settings', font_settings: '/api/font_settings', button_styles: '/api/button_styles', card_styles: '/api/card_styles', system_settings: '/api/system_settings', tenants: '/api/tenants', roles: '/api/roles' }
};
</script>

<!-- jQuery + Bootstrap Bundle -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Console capture -->
<script>
const logs = [];
const originalLog = console.log;
const originalError = console.error;

console.log = function(...args) {
    logs.push('[LOG] ' + args.join(' '));
    updateConsole();
    originalLog.apply(console, args);
};
console.error = function(...args) {
    logs.push('[ERROR] ' + args.join(' '));
    updateConsole();
    originalError.apply(console, args);
};
function updateConsole() {
    document.getElementById('console-output').textContent = logs.join('\n');
}
</script>

<!-- Checks -->
<script>
function checkConfig() {
    const div = document.getElementById('config-check');
    if (window.APP_CONFIG) {
        div.innerHTML = `<p class="success">✓ APP_CONFIG loaded successfully</p><pre>${JSON.stringify(window.APP_CONFIG, null, 2)}</pre>`;
        console.log('APP_CONFIG loaded:', window.APP_CONFIG);
    } else {
        div.innerHTML = `<p class="error">✗ APP_CONFIG not found</p>`;
        console.error('APP_CONFIG not found');
    }
}

function checkJS() {
    const jsDiv = document.getElementById('js-check');
    if (typeof ThemeManager !== 'undefined') {
        jsDiv.innerHTML = `<p class="success">✓ ThemeManager class loaded</p>`;
        console.log('ThemeManager class found');
    } else {
        jsDiv.innerHTML = `<p class="error">✗ ThemeManager class not found</p><p>Check Network tab</p>`;
        console.error('ThemeManager class not found');
    }
}

async function testAPI() {
    const resultDiv = document.getElementById('api-result');
    resultDiv.innerHTML = '<p>Testing API...</p>';
    try {
        const response = await fetch('/api/themes', { headers: { 'Accept':'application/json','Content-Type':'application/json' } });
        const data = await response.json();
        resultDiv.innerHTML = `<p class="${response.ok ? 'success' : 'error'}">Status: ${response.status} ${response.statusText}</p><pre>${JSON.stringify(data,null,2)}</pre>`;
        console.log('API response:', data);
    } catch (err) {
        resultDiv.innerHTML = `<p class="error">Error: ${err.message}</p>`;
        console.error('API Error:', err);
    }
}

window.addEventListener('load', () => {
    console.log('Page loaded');
    checkConfig();
    setTimeout(checkJS, 500);
});
</script>

<!-- Load ThemeManager -->
<script src="/admin/assets/js/pages/AdminUiThemeLoader.js"></script>

</body>
</html>
